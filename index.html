<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title id="pageTitle">تسجيل الدخول - بقالة الحي</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700&display=swap');
        
        * {
            font-family: 'Cairo', sans-serif;
        }
        
        .glass {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .glass-dark {
            background: rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .google-btn {
            transition: all 0.3s ease;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .google-btn:hover {
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
            transform: translateY(-1px);
        }
        
        .loading-spinner {
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top: 3px solid #ffffff;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 16px 24px;
            border-radius: 12px;
            color: white;
            font-weight: 600;
            z-index: 1000;
            transform: translateX(400px);
            transition: transform 0.3s ease;
        }
        
        .notification.show {
            transform: translateX(0);
        }
        
        .notification.success {
            background: linear-gradient(135deg, #10B981, #059669);
        }
        
        .notification.error {
            background: linear-gradient(135deg, #EF4444, #DC2626);
        }
        
        .notification.info {
            background: linear-gradient(135deg, #3B82F6, #2563EB);
        }
        
        .input-group {
            position: relative;
        }
        
        .input-group input {
            padding-right: 3rem;
        }
        
        .input-icon {
            position: absolute;
            right: 1rem;
            top: 50%;
            transform: translateY(-50%);
            color: rgba(255, 255, 255, 0.6);
        }
        
        .password-toggle {
            position: absolute;
            left: 1rem;
            top: 50%;
            transform: translateY(-50%);
            color: rgba(255, 255, 255, 0.6);
            cursor: pointer;
            transition: color 0.3s ease;
        }
        
        .password-toggle:hover {
            color: rgba(255, 255, 255, 0.9);
        }
        
        .container-padding {
            padding: 0 1rem;
        }
        
        @media (min-width: 640px) {
            .container-padding {
                padding: 0 1.5rem;
            }
        }
        
        @media (max-width: 640px) {
            .notification {
                right: 10px;
                left: 10px;
                transform: translateY(-100px);
            }
            
            .notification.show {
                transform: translateY(0);
            }
        }
    </style>
</head>
<body class="min-h-screen bg-gradient-to-br from-blue-400 via-purple-500 to-pink-500 flex items-center justify-center p-4">
    
    <!-- Login Container -->
    <div class="glass-dark p-8 rounded-2xl max-w-md w-full mx-auto">
        <!-- Header -->
        <div class="text-center mb-8">
            <div class="mb-6">
                <i class="fas fa-store text-6xl text-white mb-4"></i>
            </div>
            <h1 class="text-3xl font-bold text-white mb-2">مرحباً بك</h1>
            <p class="text-gray-300">سجل دخولك للمتابعة</p>
        </div>
        
        <!-- Login Form -->
        <div class="space-y-6">
            <!-- Google Sign In Button -->
            <button id="googleSignInBtn" class="google-btn w-full bg-white p-4 rounded-lg text-gray-700 hover:bg-gray-50 transition-all border border-gray-300 flex items-center justify-center gap-3 font-medium">
                <svg width="20" height="20" viewBox="0 0 24 24">
                    <path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/>
                    <path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/>
                    <path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/>
                    <path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/>
                </svg>
                تسجيل الدخول بحساب جوجل
            </button>
            
            <!-- Divider -->
            <div class="flex items-center gap-4">
                <div class="flex-1 h-px bg-white bg-opacity-30"></div>
                <span class="text-gray-300 text-sm">أو</span>
                <div class="flex-1 h-px bg-white bg-opacity-30"></div>
            </div>
            
            <!-- Email Input -->
            <div class="input-group">
                <input type="email" id="loginEmail" placeholder="البريد الإلكتروني" 
                       class="w-full p-4 rounded-lg bg-white bg-opacity-20 text-white placeholder-gray-300 border border-white border-opacity-30 focus:border-blue-400 focus:outline-none transition-all">
                <i class="fas fa-envelope input-icon"></i>
            </div>
            
            <!-- Password Input -->
            <div class="input-group">
                <input type="password" id="loginPassword" placeholder="كلمة المرور" 
                       class="w-full p-4 rounded-lg bg-white bg-opacity-20 text-white placeholder-gray-300 border border-white border-opacity-30 focus:border-blue-400 focus:outline-none transition-all">
                <i class="fas fa-lock input-icon"></i>
                <i class="fas fa-eye password-toggle" id="togglePassword"></i>
            </div>
            
            <!-- Action Buttons -->
            <div class="space-y-3">
                <button id="loginSubmitBtn" class="w-full bg-gradient-to-r from-green-500 to-green-600 p-4 rounded-lg text-white hover:from-green-600 hover:to-green-700 transition-all font-medium shadow-lg">
                    <i class="fas fa-sign-in-alt ml-2"></i>
                    تسجيل الدخول
                </button>
                
                <button id="registerBtn" class="w-full bg-gradient-to-r from-blue-500 to-blue-600 p-4 rounded-lg text-white hover:from-blue-600 hover:to-blue-700 transition-all font-medium shadow-lg">
                    <i class="fas fa-user-plus ml-2"></i>
                    إنشاء حساب جديد
                </button>
            </div>
            
            <!-- Loading Indicator -->
            <div id="loginLoading" class="hidden text-center">
                <div class="inline-flex items-center px-4 py-2 font-semibold leading-6 text-sm shadow rounded-md text-white bg-blue-500">
                    <div class="loading-spinner mr-3"></div>
                    جاري تسجيل الدخول...
                </div>
            </div>
        </div>
        
        <!-- Footer -->
        <div class="mt-8 text-center">
            <p class="text-gray-400 text-sm">
                بالمتابعة، أنت توافق على 
                <a href="#" class="text-blue-400 hover:text-blue-300 transition-colors">شروط الاستخدام</a>
                و
                <a href="#" class="text-blue-400 hover:text-blue-300 transition-colors">سياسة الخصوصية</a>
            </p>
        </div>
    </div>

    <!-- Main App (Hidden Initially) -->
    <div id="mainApp" class="hidden w-full min-h-screen">
        <!-- Header -->
        <header class="glass container-padding m-2 sm:m-4 rounded-2xl">
            <div class="header-content flex justify-between items-center">
                <div class="flex items-center gap-2 sm:gap-4">
                    <i class="fas fa-store text-2xl sm:text-3xl text-white"></i>
                    <div>
                        <h1 id="storeNameHeader" class="text-lg sm:text-2xl font-bold text-white">بقالة الحي</h1>
                        <p class="text-gray-200 text-xs sm:text-sm">أهلاً <span id="userNameDisplay"></span></p>
                    </div>
                </div>
                
                <div class="flex items-center gap-2 sm:gap-4">
                    <!-- User Profile Picture -->
                    <div id="userProfileContainer" class="hidden">
                        <img id="userProfilePic" src="" alt="صورة المستخدم" class="w-10 h-10 rounded-full border-2 border-white border-opacity-50">
                    </div>
                    
                    <!-- Cart Button -->
                    <button id="cartBtn" class="relative glass px-3 sm:px-4 py-2 rounded-lg text-white hover:bg-white hover:bg-opacity-20 transition-all">
                        <i class="fas fa-shopping-cart text-lg sm:text-xl"></i>
                        <span id="cartBadge" class="absolute -top-2 -right-2 bg-red-500 text-white rounded-full w-5 h-5 text-xs flex items-center justify-center">0</span>
                    </button>
                    
                    <!-- Logout Button -->
                    <button id="logoutBtn" class="bg-red-500 px-3 sm:px-4 py-2 rounded-lg text-white hover:bg-red-600 transition-all text-sm sm:text-base">
                        <i class="fas fa-sign-out-alt ml-1 sm:ml-2"></i>
                        <span class="hidden sm:inline">خروج</span>
                    </button>
                </div>
            </div>
        </header>

        <!-- Navigation -->
        <nav class="glass container-padding m-2 sm:m-4 rounded-2xl">
            <div class="text-center">
                <h2 class="text-xl sm:text-2xl font-bold text-white">
                    <i class="fas fa-th-large ml-2"></i>
                    <span>لوحة التحكم - الأقسام</span>
                </h2>
                <p class="text-gray-200 text-sm mt-2">اختر القسم المطلوب للانتقال إليه</p>
            </div>
        </nav>

        <!-- Categories Page -->
        <div id="categoriesPage" class="container-padding">
            <!-- Dashboard Stats (Admin Only) -->
            <div id="dashboardStats" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-3 sm:gap-4 mb-6">
                <!-- Stats will be populated here -->
            </div>
            
            <div id="categoriesGrid" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 2xl:grid-cols-8 gap-3 sm:gap-4 md:gap-6">
                <!-- Categories will be populated here -->
            </div>
        </div>

        <!-- Products Page -->
        <div id="productsPage" class="hidden container-padding">
            <!-- Back Button and Category Header -->
            <div class="glass p-4 rounded-2xl mb-6">
                <div class="flex items-center justify-between">
                    <button id="backToCategoriesBtn" class="flex items-center gap-2 text-white hover:text-blue-300 transition-colors">
                        <i class="fas fa-arrow-right text-xl"></i>
                        <span class="font-medium">العودة للأقسام</span>
                    </button>
                    <div class="text-center">
                        <h2 id="categoryTitle" class="text-xl sm:text-2xl font-bold text-white"></h2>
                        <p id="categorySubtitle" class="text-gray-200 text-sm"></p>
                    </div>
                    <div></div>
                </div>
            </div>
            
            <!-- Products Grid -->
            <div id="productsGrid" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 2xl:grid-cols-6 gap-4 md:gap-6">
                <!-- Products will be populated here -->
            </div>
        </div>

        <!-- Admin Settings Page -->
        <div id="adminSettingsPage" class="hidden container-padding">
            <!-- Back Button and Settings Header -->
            <div class="glass p-4 rounded-2xl mb-6">
                <div class="flex items-center justify-between">
                    <button id="backFromSettingsBtn" class="flex items-center gap-2 text-white hover:text-blue-300 transition-colors">
                        <i class="fas fa-arrow-right text-xl"></i>
                        <span class="font-medium">العودة للأقسام</span>
                    </button>
                    <div class="text-center">
                        <h2 class="text-xl sm:text-2xl font-bold text-white">
                            <i class="fas fa-crown text-yellow-400 ml-2"></i>
                            إعدادات المدير
                        </h2>
                        <p class="text-gray-200 text-sm">تحكم في إعدادات النظام</p>
                    </div>
                    <div></div>
                </div>
            </div>
            
            <!-- Settings Content -->
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                <!-- Store Name Setting -->
                <div class="glass p-6 rounded-2xl">
                    <div class="text-center mb-4">
                        <i class="fas fa-store text-3xl text-yellow-400 mb-3"></i>
                        <h3 class="text-lg font-bold text-white">اسم المتجر</h3>
                        <p class="text-gray-300 text-sm">تغيير اسم المتجر في جميع أنحاء الموقع</p>
                    </div>
                    <div class="space-y-3">
                        <input type="text" id="storeNameSetting" placeholder="اسم المتجر" 
                               class="w-full p-3 rounded-lg bg-white bg-opacity-20 text-white placeholder-gray-300 border border-white border-opacity-30 focus:border-yellow-400 focus:outline-none transition-all">
                        <button id="updateStoreNameBtn" class="w-full bg-gradient-to-r from-yellow-500 to-yellow-600 p-3 rounded-lg text-white hover:from-yellow-600 hover:to-yellow-700 transition-all font-medium">
                            <i class="fas fa-save ml-2"></i>
                            تحديث اسم المتجر
                        </button>
                    </div>
                </div>

                <!-- Admin Email Setting -->
                <div class="glass p-6 rounded-2xl">
                    <div class="text-center mb-4">
                        <i class="fas fa-envelope text-3xl text-blue-400 mb-3"></i>
                        <h3 class="text-lg font-bold text-white">إيميل المدير</h3>
                        <p class="text-gray-300 text-sm">تحديد الإيميل الذي يحصل على صلاحيات المدير</p>
                    </div>
                    <div class="space-y-3">
                        <input type="email" id="adminEmailSetting" placeholder="admin@store.com" 
                               class="w-full p-3 rounded-lg bg-white bg-opacity-20 text-white placeholder-gray-300 border border-white border-opacity-30 focus:border-blue-400 focus:outline-none transition-all">
                        <button id="updateAdminEmailBtn" class="w-full bg-gradient-to-r from-blue-500 to-blue-600 p-3 rounded-lg text-white hover:from-blue-600 hover:to-blue-700 transition-all font-medium">
                            <i class="fas fa-save ml-2"></i>
                            حفظ التغييرات
                        </button>
                    </div>
                </div>

                <!-- Admin Password Setting -->
                <div class="glass p-6 rounded-2xl">
                    <div class="text-center mb-4">
                        <i class="fas fa-key text-3xl text-purple-400 mb-3"></i>
                        <h3 class="text-lg font-bold text-white">كلمة مرور المدير</h3>
                        <p class="text-gray-300 text-sm">تغيير كلمة مرور دخول المدير</p>
                    </div>
                    <div class="space-y-3">
                        <input type="password" id="adminPasswordSetting" placeholder="كلمة المرور الجديدة" 
                               class="w-full p-3 rounded-lg bg-white bg-opacity-20 text-white placeholder-gray-300 border border-white border-opacity-30 focus:border-purple-400 focus:outline-none transition-all">
                        <button id="updateAdminPasswordBtn" class="w-full bg-gradient-to-r from-purple-500 to-purple-600 p-3 rounded-lg text-white hover:from-purple-600 hover:to-purple-700 transition-all font-medium">
                            <i class="fas fa-save ml-2"></i>
                            تحديث كلمة المرور
                        </button>
                    </div>
                </div>

                <!-- Wallet Settings -->
                <div class="glass p-6 rounded-2xl">
                    <div class="text-center mb-4">
                        <i class="fas fa-wallet text-3xl text-green-400 mb-3"></i>
                        <h3 class="text-lg font-bold text-white">إعدادات المحفظة</h3>
                        <p class="text-gray-300 text-sm">رقم المحفظة ومقدم الخدمة لاستقبال المدفوعات</p>
                    </div>
                    <div class="space-y-3">
                        <select id="walletProviderSetting" class="w-full p-3 rounded-lg bg-white bg-opacity-20 text-white border border-white border-opacity-30 focus:border-green-400 focus:outline-none transition-all">
                            <option value="vodafone">فودافون كاش</option>
                            <option value="etisalat">اتصالات كاش</option>
                            <option value="orange">أورانج كاش</option>
                        </select>
                        <input type="tel" id="walletNumberSetting" placeholder="01xxxxxxxxx" 
                               class="w-full p-3 rounded-lg bg-white bg-opacity-20 text-white placeholder-gray-300 border border-white border-opacity-30 focus:border-green-400 focus:outline-none transition-all">
                        <button id="updateWalletBtn" class="w-full bg-gradient-to-r from-green-500 to-green-600 p-3 rounded-lg text-white hover:from-green-600 hover:to-green-700 transition-all font-medium">
                            <i class="fas fa-save ml-2"></i>
                            تحديث المحفظة
                        </button>
                    </div>
                </div>

                <!-- Store Statistics -->
                <div class="glass p-6 rounded-2xl">
                    <div class="text-center mb-4">
                        <i class="fas fa-chart-bar text-3xl text-cyan-400 mb-3"></i>
                        <h3 class="text-lg font-bold text-white">إحصائيات المتجر</h3>
                        <p class="text-gray-300 text-sm">معلومات عامة عن المتجر</p>
                    </div>
                    <div class="space-y-3 text-white">
                        <div class="flex justify-between">
                            <span>عدد الأقسام:</span>
                            <span class="font-bold text-blue-400" id="categoriesCount">0</span>
                        </div>
                        <div class="flex justify-between">
                            <span>عدد المنتجات:</span>
                            <span class="font-bold text-green-400" id="productsCount">0</span>
                        </div>
                        <div class="flex justify-between">
                            <span>المنتجات المتاحة:</span>
                            <span class="font-bold text-yellow-400" id="availableProductsCount">0</span>
                        </div>
                    </div>
                </div>

                <!-- Category Management -->
                <div class="glass p-6 rounded-2xl">
                    <div class="text-center mb-4">
                        <i class="fas fa-th-large text-3xl text-purple-400 mb-3"></i>
                        <h3 class="text-lg font-bold text-white">إدارة الأقسام</h3>
                        <p class="text-gray-300 text-sm">إضافة وتعديل أقسام المتجر</p>
                    </div>
                    <div class="space-y-3">
                        <button id="addCategoryBtn" class="w-full bg-gradient-to-r from-purple-500 to-purple-600 p-3 rounded-lg text-white hover:from-purple-600 hover:to-purple-700 transition-all font-medium">
                            <i class="fas fa-plus ml-2"></i>
                            إضافة قسم جديد
                        </button>
                        <button id="manageCategoriesBtn" class="w-full bg-gradient-to-r from-indigo-500 to-indigo-600 p-3 rounded-lg text-white hover:from-indigo-600 hover:to-indigo-700 transition-all font-medium">
                            <i class="fas fa-edit ml-2"></i>
                            تعديل الأقسام
                        </button>
                    </div>
                </div>

                <!-- Product Management -->
                <div class="glass p-6 rounded-2xl">
                    <div class="text-center mb-4">
                        <i class="fas fa-boxes text-3xl text-orange-400 mb-3"></i>
                        <h3 class="text-lg font-bold text-white">إدارة المنتجات</h3>
                        <p class="text-gray-300 text-sm">إضافة وتعديل منتجات المتجر</p>
                    </div>
                    <div class="space-y-3">
                        <button id="addProductBtn" class="w-full bg-gradient-to-r from-orange-500 to-orange-600 p-3 rounded-lg text-white hover:from-orange-600 hover:to-orange-700 transition-all font-medium">
                            <i class="fas fa-plus ml-2"></i>
                            إضافة منتج جديد
                        </button>
                        <button id="manageProductsBtn" class="w-full bg-gradient-to-r from-red-500 to-red-600 p-3 rounded-lg text-white hover:from-red-600 hover:to-red-700 transition-all font-medium">
                            <i class="fas fa-edit ml-2"></i>
                            تعديل المنتجات
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Global State
        let currentUser = null;
        let isAdmin = false;
        let cart = [];
        let currentPage = 'categories';
        let selectedCategory = null;
        let adminEmail = 'ahmedmoradm70@gmail.com'; // Default admin email
        let adminPassword = '15926357'; // Default admin password
        let storeName = 'بقالة الحي'; // Default store name
        let walletNumber = '01012345678'; // Default wallet number
        let walletProvider = 'vodafone'; // Default wallet provider

        // Sample Data
        let categories = [
            { id: 1, name: 'الجبن والألبان', icon: 'fas fa-cheese', color: '#FFD700' },
            { id: 2, name: 'البقوليات', icon: 'fas fa-seedling', color: '#8B4513' },
            { id: 3, name: 'التسالي', icon: 'fas fa-cookie', color: '#FF6347' },
            { id: 4, name: 'المعلبات', icon: 'fas fa-box', color: '#32CD32' },
            { id: 5, name: 'العطارة', icon: 'fas fa-leaf', color: '#9370DB' },
            { id: 6, name: 'المنظفات', icon: 'fas fa-spray-can', color: '#00CED1' },
            { id: 7, name: 'الأدوات المدرسية', icon: 'fas fa-graduation-cap', color: '#FF4500' }
        ];

        let products = [
            { id: 1, name: 'جبنة بيضاء', price: 45.00, categoryId: 1, stock: 20, discount: 0, image: '🧀' },
            { id: 2, name: 'حليب طازج', price: 25.00, categoryId: 1, stock: 15, discount: 10, image: '🥛' },
            { id: 3, name: 'لبنة', price: 30.00, categoryId: 1, stock: 25, discount: 0, image: '🥛' },
            { id: 4, name: 'زبدة', price: 35.00, categoryId: 1, stock: 18, discount: 5, image: '🧈' },
            { id: 5, name: 'عدس أحمر', price: 35.00, categoryId: 2, stock: 30, discount: 0, image: '🌾' },
            { id: 6, name: 'حمص حب', price: 40.00, categoryId: 2, stock: 25, discount: 15, image: '🌾' },
            { id: 7, name: 'فول مدمس', price: 28.00, categoryId: 2, stock: 35, discount: 0, image: '🌾' },
            { id: 8, name: 'فاصوليا بيضاء', price: 32.00, categoryId: 2, stock: 22, discount: 8, image: '🌾' },
            { id: 9, name: 'شيبس', price: 15.00, categoryId: 3, stock: 40, discount: 0, image: '🍟' },
            { id: 10, name: 'مكسرات مشكلة', price: 80.00, categoryId: 3, stock: 20, discount: 20, image: '🥜' },
            { id: 11, name: 'بسكويت', price: 12.00, categoryId: 3, stock: 50, discount: 0, image: '🍪' },
            { id: 12, name: 'شوكولاتة', price: 25.00, categoryId: 3, stock: 30, discount: 10, image: '🍫' },
            { id: 13, name: 'تونة معلبة', price: 18.00, categoryId: 4, stock: 45, discount: 0, image: '🥫' },
            { id: 14, name: 'ذرة معلبة', price: 12.00, categoryId: 4, stock: 38, discount: 5, image: '🥫' },
            { id: 15, name: 'طماطم معلبة', price: 15.00, categoryId: 4, stock: 42, discount: 0, image: '🥫' },
            { id: 16, name: 'زيت زيتون', price: 65.00, categoryId: 5, stock: 15, discount: 12, image: '🫒' },
            { id: 17, name: 'عسل طبيعي', price: 85.00, categoryId: 5, stock: 12, discount: 0, image: '🍯' },
            { id: 18, name: 'زعتر', price: 22.00, categoryId: 5, stock: 28, discount: 0, image: '🌿' },
            { id: 19, name: 'صابون غسيل', price: 8.00, categoryId: 6, stock: 60, discount: 0, image: '🧼' },
            { id: 20, name: 'منظف أرضيات', price: 18.00, categoryId: 6, stock: 35, discount: 15, image: '🧽' },
            { id: 21, name: 'قلم رصاص', price: 2.50, categoryId: 7, stock: 100, discount: 0, image: '✏️' },
            { id: 22, name: 'دفتر مدرسي', price: 12.00, categoryId: 7, stock: 50, discount: 10, image: '📓' },
            { id: 23, name: 'مسطرة', price: 5.00, categoryId: 7, stock: 40, discount: 0, image: '📏' },
            { id: 24, name: 'ممحاة', price: 3.00, categoryId: 7, stock: 80, discount: 0, image: '🧽' },
            { id: 25, name: 'مقص', price: 15.00, categoryId: 7, stock: 25, discount: 5, image: '✂️' },
            { id: 26, name: 'صمغ', price: 8.00, categoryId: 7, stock: 35, discount: 0, image: '🧴' }
        ];

        // DOM Elements
        const loginContainer = document.querySelector('.glass-dark');
        const mainApp = document.getElementById('mainApp');
        const googleSignInBtn = document.getElementById('googleSignInBtn');
        const loginSubmitBtn = document.getElementById('loginSubmitBtn');
        const registerBtn = document.getElementById('registerBtn');
        const togglePasswordBtn = document.getElementById('togglePassword');
        const loginLoading = document.getElementById('loginLoading');
        const loginEmail = document.getElementById('loginEmail');
        const loginPassword = document.getElementById('loginPassword');
        const userNameDisplay = document.getElementById('userNameDisplay');
        const logoutBtn = document.getElementById('logoutBtn');
        const cartBadge = document.getElementById('cartBadge');

        // Initialize
        init();

        function init() {
            setupEventListeners();
        }

        function setupEventListeners() {
            // Google Sign In
            googleSignInBtn.addEventListener('click', handleGoogleSignIn);
            
            // Email/Password Login
            loginSubmitBtn.addEventListener('click', handleEmailLogin);
            
            // Register
            registerBtn.addEventListener('click', handleEmailRegister);
            
            // Password toggle
            togglePasswordBtn.addEventListener('click', togglePasswordVisibility);
            
            // Logout
            logoutBtn.addEventListener('click', handleLogout);
            
            // Cart button
            document.getElementById('cartBtn').addEventListener('click', showCart);
            
            // Navigation buttons
            document.getElementById('backToCategoriesBtn').addEventListener('click', () => navigateToPage('categories'));
            document.getElementById('backFromSettingsBtn').addEventListener('click', () => navigateToPage('categories'));
            
            // Admin settings buttons
            document.getElementById('updateStoreNameBtn').addEventListener('click', updateStoreName);
            document.getElementById('updateAdminEmailBtn').addEventListener('click', updateAdminEmail);
            document.getElementById('updateAdminPasswordBtn').addEventListener('click', updateAdminPassword);
            document.getElementById('updateWalletBtn').addEventListener('click', updateWalletSettings);
            document.getElementById('addCategoryBtn').addEventListener('click', showAddCategoryModal);
            document.getElementById('manageCategoriesBtn').addEventListener('click', showManageCategoriesModal);
            document.getElementById('addProductBtn').addEventListener('click', showAddProductModal);
            document.getElementById('manageProductsBtn').addEventListener('click', showManageProductsModal);
            
            // Enter key login
            loginPassword.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') handleEmailLogin();
            });
            loginEmail.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') handleEmailLogin();
            });
        }

        function togglePasswordVisibility() {
            const passwordInput = document.getElementById('loginPassword');
            const toggleIcon = togglePasswordBtn;
            
            if (passwordInput.type === 'password') {
                passwordInput.type = 'text';
                toggleIcon.className = 'fas fa-eye-slash password-toggle';
            } else {
                passwordInput.type = 'password';
                toggleIcon.className = 'fas fa-eye password-toggle';
            }
        }

        function showLoading(show = true) {
            if (show) {
                loginLoading.classList.remove('hidden');
                googleSignInBtn.disabled = true;
                loginSubmitBtn.disabled = true;
                registerBtn.disabled = true;
                googleSignInBtn.style.opacity = '0.6';
                loginSubmitBtn.style.opacity = '0.6';
                registerBtn.style.opacity = '0.6';
            } else {
                loginLoading.classList.add('hidden');
                googleSignInBtn.disabled = false;
                loginSubmitBtn.disabled = false;
                registerBtn.disabled = false;
                googleSignInBtn.style.opacity = '1';
                loginSubmitBtn.style.opacity = '1';
                registerBtn.style.opacity = '1';
            }
        }

        async function handleAdminLogin() {
            try {
                showLoading(true);
                
                // Simulate admin login process
                await new Promise(resolve => setTimeout(resolve, 1500));
                
                // Set admin user data
                const adminData = {
                    name: 'المدير العام',
                    email: 'admin@store.com',
                    photoURL: null,
                    isAdmin: true
                };
                
                handleLoginSuccess(adminData);
                
            } catch (error) {
                console.error('Admin Login Error:', error);
                showNotification('حدث خطأ في تسجيل دخول المدير ❌', 'error');
            } finally {
                showLoading(false);
            }
        }

        async function handleGoogleSignIn() {
            try {
                showLoading(true);
                
                // Simulate Google Sign-In process
                await new Promise(resolve => setTimeout(resolve, 2000));
                
                // Simulate successful Google login with random email
                const emails = ['ahmed@gmail.com', 'sara@gmail.com', 'mohammed@gmail.com', adminEmail];
                const randomEmail = emails[Math.floor(Math.random() * emails.length)];
                
                const userData = {
                    name: randomEmail === adminEmail ? 'المدير العام' : randomEmail.split('@')[0],
                    email: randomEmail,
                    photoURL: null,
                    isAdmin: randomEmail === adminEmail
                };
                
                handleLoginSuccess(userData);
                
            } catch (error) {
                console.error('Google Sign-In Error:', error);
                showNotification('حدث خطأ في تسجيل الدخول بجوجل ❌', 'error');
            } finally {
                showLoading(false);
            }
        }

        async function handleEmailLogin() {
            const email = loginEmail.value.trim();
            const password = loginPassword.value.trim();

            if (!email || !password) {
                showNotification('يرجى ملء جميع الحقول! ⚠️', 'error');
                return;
            }

            if (!isValidEmail(email)) {
                showNotification('يرجى إدخال بريد إلكتروني صحيح! ⚠️', 'error');
                return;
            }

            try {
                showLoading(true);
                
                // Simulate login process
                await new Promise(resolve => setTimeout(resolve, 1500));
                
                // Check if admin credentials
                if (email === adminEmail && password === adminPassword) {
                    const userData = {
                        name: 'المدير العام',
                        email: email,
                        photoURL: null,
                        isAdmin: true
                    };
                    handleLoginSuccess(userData);
                    return;
                }
                
                // Check registered users
                const user = registeredUsers.find(u => u.email === email && u.password === password);
                if (user) {
                    const userData = {
                        name: user.name,
                        email: user.email,
                        photoURL: null,
                        isAdmin: email === adminEmail
                    };
                    handleLoginSuccess(userData);
                } else {
                    // Check if email exists but wrong password
                    const emailExists = registeredUsers.find(u => u.email === email);
                    if (emailExists) {
                        showNotification('كلمة المرور غير صحيحة! ❌', 'error');
                    } else {
                        showNotification('هذا الإيميل غير مسجل! يرجى إنشاء حساب جديد أولاً 📧', 'error');
                    }
                }
                
            } catch (error) {
                console.error('Email Login Error:', error);
                showNotification('خطأ في تسجيل الدخول ❌', 'error');
            } finally {
                showLoading(false);
            }
        }

        // User database simulation
        let registeredUsers = [
            { email: 'ahmed@gmail.com', password: '123456', name: 'أحمد محمد' },
            { email: 'sara@gmail.com', password: '123456', name: 'سارة أحمد' },
            { email: 'mohammed@gmail.com', password: '123456', name: 'محمد علي' }
        ];

        async function handleEmailRegister() {
            // Show registration modal instead of using login form fields
            showRegistrationModal();
        }

        function showRegistrationModal() {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4';
            modal.innerHTML = `
                <div class="glass-dark p-8 rounded-2xl max-w-md w-full">
                    <div class="text-center mb-8">
                        <i class="fas fa-user-plus text-6xl text-blue-400 mb-4"></i>
                        <h2 class="text-3xl font-bold text-white mb-2">إنشاء حساب جديد</h2>
                        <p class="text-gray-300">أدخل بياناتك لإنشاء حساب جديد</p>
                    </div>
                    
                    <div class="space-y-6">
                        <!-- Name Input -->
                        <div class="input-group">
                            <input type="text" id="registerName" placeholder="الاسم الكامل" 
                                   class="w-full p-4 rounded-lg bg-white bg-opacity-20 text-white placeholder-gray-300 border border-white border-opacity-30 focus:border-blue-400 focus:outline-none transition-all">
                            <i class="fas fa-user input-icon"></i>
                        </div>
                        
                        <!-- Email Input -->
                        <div class="input-group">
                            <input type="email" id="registerEmail" placeholder="البريد الإلكتروني" 
                                   class="w-full p-4 rounded-lg bg-white bg-opacity-20 text-white placeholder-gray-300 border border-white border-opacity-30 focus:border-blue-400 focus:outline-none transition-all">
                            <i class="fas fa-envelope input-icon"></i>
                        </div>
                        
                        <!-- Password Input -->
                        <div class="input-group">
                            <input type="password" id="registerPassword" placeholder="كلمة المرور (6 أحرف على الأقل)" 
                                   class="w-full p-4 rounded-lg bg-white bg-opacity-20 text-white placeholder-gray-300 border border-white border-opacity-30 focus:border-blue-400 focus:outline-none transition-all">
                            <i class="fas fa-lock input-icon"></i>
                            <i class="fas fa-eye password-toggle" id="toggleRegisterPassword"></i>
                        </div>
                        
                        <!-- Confirm Password Input -->
                        <div class="input-group">
                            <input type="password" id="confirmPassword" placeholder="تأكيد كلمة المرور" 
                                   class="w-full p-4 rounded-lg bg-white bg-opacity-20 text-white placeholder-gray-300 border border-white border-opacity-30 focus:border-blue-400 focus:outline-none transition-all">
                            <i class="fas fa-lock input-icon"></i>
                            <i class="fas fa-eye password-toggle" id="toggleConfirmPassword"></i>
                        </div>
                        
                        <!-- Terms Checkbox -->
                        <div class="flex items-center gap-3">
                            <input type="checkbox" id="acceptTerms" class="w-5 h-5 rounded border-2 border-white border-opacity-30 bg-white bg-opacity-20 text-blue-500 focus:ring-blue-400">
                            <label for="acceptTerms" class="text-gray-300 text-sm">
                                أوافق على 
                                <a href="#" class="text-blue-400 hover:text-blue-300 transition-colors">شروط الاستخدام</a>
                                و
                                <a href="#" class="text-blue-400 hover:text-blue-300 transition-colors">سياسة الخصوصية</a>
                            </label>
                        </div>
                        
                        <!-- Action Buttons -->
                        <div class="space-y-3">
                            <button id="createAccountBtn" class="w-full bg-gradient-to-r from-blue-500 to-blue-600 p-4 rounded-lg text-white hover:from-blue-600 hover:to-blue-700 transition-all font-medium shadow-lg">
                                <i class="fas fa-user-plus ml-2"></i>
                                إنشاء الحساب
                            </button>
                            
                            <button id="backToLoginBtn" class="w-full bg-gradient-to-r from-gray-500 to-gray-600 p-4 rounded-lg text-white hover:from-gray-600 hover:to-gray-700 transition-all font-medium">
                                <i class="fas fa-arrow-right ml-2"></i>
                                العودة لتسجيل الدخول
                            </button>
                        </div>
                        
                        <!-- Loading Indicator -->
                        <div id="registerLoading" class="hidden text-center">
                            <div class="inline-flex items-center px-4 py-2 font-semibold leading-6 text-sm shadow rounded-md text-white bg-blue-500">
                                <div class="loading-spinner mr-3"></div>
                                جاري إنشاء الحساب...
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            // Add event listeners
            document.getElementById('toggleRegisterPassword').addEventListener('click', () => {
                toggleModalPasswordVisibility('registerPassword', 'toggleRegisterPassword');
            });
            
            document.getElementById('toggleConfirmPassword').addEventListener('click', () => {
                toggleModalPasswordVisibility('confirmPassword', 'toggleConfirmPassword');
            });
            
            document.getElementById('createAccountBtn').addEventListener('click', () => {
                processRegistration();
            });
            
            document.getElementById('backToLoginBtn').addEventListener('click', () => {
                modal.remove();
            });
            
            // Enter key support
            const inputs = modal.querySelectorAll('input');
            inputs.forEach(input => {
                input.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') {
                        processRegistration();
                    }
                });
            });
            
            // Close modal when clicking outside
            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    modal.remove();
                }
            });
        }

        function toggleModalPasswordVisibility(inputId, toggleId) {
            const passwordInput = document.getElementById(inputId);
            const toggleIcon = document.getElementById(toggleId);
            
            if (passwordInput.type === 'password') {
                passwordInput.type = 'text';
                toggleIcon.className = 'fas fa-eye-slash password-toggle';
            } else {
                passwordInput.type = 'password';
                toggleIcon.className = 'fas fa-eye password-toggle';
            }
        }

        async function processRegistration() {
            const name = document.getElementById('registerName').value.trim();
            const email = document.getElementById('registerEmail').value.trim();
            const password = document.getElementById('registerPassword').value.trim();
            const confirmPassword = document.getElementById('confirmPassword').value.trim();
            const acceptTerms = document.getElementById('acceptTerms').checked;

            // Validation
            if (!name) {
                showNotification('يرجى إدخال الاسم الكامل! ⚠️', 'error');
                return;
            }

            if (!email) {
                showNotification('يرجى إدخال البريد الإلكتروني! ⚠️', 'error');
                return;
            }

            if (!isValidEmail(email)) {
                showNotification('يرجى إدخال بريد إلكتروني صحيح! ⚠️', 'error');
                return;
            }

            if (!password) {
                showNotification('يرجى إدخال كلمة المرور! ⚠️', 'error');
                return;
            }

            if (password.length < 6) {
                showNotification('كلمة المرور يجب أن تكون 6 أحرف على الأقل! ⚠️', 'error');
                return;
            }

            if (password !== confirmPassword) {
                showNotification('كلمة المرور وتأكيدها غير متطابقتين! ⚠️', 'error');
                return;
            }

            if (!acceptTerms) {
                showNotification('يرجى الموافقة على شروط الاستخدام! ⚠️', 'error');
                return;
            }

            // Check if user already exists
            const existingUser = registeredUsers.find(user => user.email === email);
            if (existingUser) {
                showNotification('هذا الإيميل مسجل مسبقاً! يرجى تسجيل الدخول بدلاً من ذلك 📧', 'error');
                return;
            }

            try {
                // Show loading
                document.getElementById('registerLoading').classList.remove('hidden');
                document.getElementById('createAccountBtn').disabled = true;
                document.getElementById('backToLoginBtn').disabled = true;
                
                // Simulate registration process
                await new Promise(resolve => setTimeout(resolve, 2000));
                
                // Add new user to database
                const newUser = {
                    email: email,
                    password: password,
                    name: name
                };
                registeredUsers.push(newUser);
                
                // Create user data for login
                const userData = {
                    name: name,
                    email: email,
                    photoURL: null,
                    isAdmin: email === adminEmail
                };
                
                // Close modal
                document.querySelector('.fixed.inset-0').remove();
                
                // Login the user
                handleLoginSuccess(userData, true);
                
            } catch (error) {
                console.error('Registration Error:', error);
                showNotification('خطأ في إنشاء الحساب ❌', 'error');
            } finally {
                // Hide loading
                const loadingElement = document.getElementById('registerLoading');
                const createBtn = document.getElementById('createAccountBtn');
                const backBtn = document.getElementById('backToLoginBtn');
                
                if (loadingElement) loadingElement.classList.add('hidden');
                if (createBtn) createBtn.disabled = false;
                if (backBtn) backBtn.disabled = false;
            }
        }

        function handleLoginSuccess(userData, isNewUser = false) {
            // Set current user and admin status
            currentUser = userData;
            isAdmin = userData.isAdmin || false;
            
            // Hide login form and show main app
            loginContainer.style.display = 'none';
            mainApp.classList.remove('hidden');
            
            // Update user display
            userNameDisplay.textContent = userData.name;
            
            // Show user profile picture if available
            if (userData.photoURL) {
                document.getElementById('userProfilePic').src = userData.photoURL;
                document.getElementById('userProfileContainer').classList.remove('hidden');
            }
            
            // Initialize the app
            updateCartBadge();
            navigateToPage('categories');
            
            // Show success notification
            const message = isNewUser 
                ? `تم إنشاء الحساب بنجاح! مرحباً ${userData.name} 🎉`
                : userData.isAdmin 
                    ? `مرحباً بك أيها المدير ${userData.name}! 👑`
                    : `مرحباً بعودتك ${userData.name}! 👋`;
            
            setTimeout(() => {
                showNotification(message, 'success');
            }, 500);
        }

        function handleLogout() {
            // Reset state
            currentUser = null;
            isAdmin = false;
            cart = [];
            
            // Hide main app and show login
            mainApp.classList.add('hidden');
            loginContainer.style.display = 'block';
            
            // Clear form
            loginEmail.value = '';
            loginPassword.value = '';
            
            // Update UI
            updateCartBadge();
            
            showNotification('تم تسجيل الخروج بنجاح! 👋', 'info');
        }

        function updateCartBadge() {
            cartBadge.textContent = cart.length;
        }

        function navigateToPage(page) {
            // Hide all pages
            document.getElementById('categoriesPage').classList.add('hidden');
            document.getElementById('productsPage').classList.add('hidden');
            document.getElementById('adminSettingsPage').classList.add('hidden');
            
            // Show selected page
            currentPage = page;
            
            switch(page) {
                case 'categories':
                    document.getElementById('categoriesPage').classList.remove('hidden');
                    renderCategories();
                    break;
                case 'products':
                    document.getElementById('productsPage').classList.remove('hidden');
                    renderProducts();
                    break;
                case 'settings':
                    if (isAdmin) {
                        document.getElementById('adminSettingsPage').classList.remove('hidden');
                        renderAdminSettings();
                    } else {
                        showNotification('ليس لديك صلاحية للوصول لهذه الصفحة! ⚠️', 'error');
                        navigateToPage('categories');
                    }
                    break;
            }
        }

        function renderCategories() {
            const grid = document.getElementById('categoriesGrid');
            grid.innerHTML = '';

            if (categories.length === 0) {
                grid.innerHTML = `
                    <div class="col-span-full text-center text-gray-300 py-12">
                        <i class="fas fa-store text-6xl mb-6 text-white text-opacity-50"></i>
                        <h3 class="text-xl font-bold text-white mb-3">ابدأ رحلتك التجارية! 🚀</h3>
                        <p class="text-lg mb-4">لا توجد أقسام حالياً في متجرك</p>
                    </div>
                `;
                return;
            }

            categories.forEach(category => {
                // Count products in this category
                const productCount = products.filter(p => p.categoryId === category.id).length;
                
                const card = document.createElement('div');
                card.className = 'glass p-4 rounded-xl cursor-pointer relative transform transition-all duration-300 hover:scale-105 hover:shadow-2xl aspect-square flex items-center justify-center';
                card.style.background = `linear-gradient(135deg, ${category.color}50, ${category.color}30)`;
                card.style.border = `2px solid ${category.color}60`;
                card.style.minHeight = '160px';
                card.style.maxHeight = '160px';
                
                card.innerHTML = `
                    <div class="text-center">
                        <div class="mb-3 relative">
                            <i class="${category.icon} text-3xl text-white drop-shadow-lg"></i>
                            <div class="absolute -top-2 -right-2 bg-white bg-opacity-20 backdrop-blur-sm rounded-full w-6 h-6 flex items-center justify-center">
                                <span class="text-white text-xs font-bold">${productCount}</span>
                            </div>
                        </div>
                        <h3 class="text-base font-bold text-white mb-2 drop-shadow-md">${category.name}</h3>
                        <p class="text-white text-opacity-90 text-sm">${productCount} منتج</p>
                    </div>
                `;
                
                card.addEventListener('click', () => {
                    selectedCategory = category;
                    navigateToPage('products');
                });
                
                grid.appendChild(card);
            });

            // Add admin-only cards
            if (isAdmin) {
                // Settings card
                const settingsCard = document.createElement('div');
                settingsCard.className = 'glass p-4 rounded-xl cursor-pointer relative transform transition-all duration-300 hover:scale-105 hover:shadow-2xl aspect-square flex items-center justify-center';
                settingsCard.style.background = 'linear-gradient(135deg, #6366F150, #6366F130)';
                settingsCard.style.border = '2px solid #6366F160';
                settingsCard.style.minHeight = '160px';
                settingsCard.style.maxHeight = '160px';
                
                settingsCard.innerHTML = `
                    <div class="text-center">
                        <div class="mb-3 relative">
                            <i class="fas fa-cog text-3xl text-white drop-shadow-lg"></i>
                            <div class="absolute -top-2 -right-2 bg-red-500 rounded-full w-6 h-6 flex items-center justify-center">
                                <i class="fas fa-crown text-white text-xs"></i>
                            </div>
                        </div>
                        <h3 class="text-base font-bold text-white mb-2 drop-shadow-md">الإعدادات</h3>
                        <p class="text-white text-opacity-90 text-sm">إدارة النظام</p>
                    </div>
                `;
                
                settingsCard.addEventListener('click', () => {
                    navigateToPage('settings');
                });
                
                grid.appendChild(settingsCard);
            }
        }

        function renderProducts() {
            if (!selectedCategory) return;
            
            // Update category header
            document.getElementById('categoryTitle').textContent = selectedCategory.name;
            const categoryProducts = products.filter(p => p.categoryId === selectedCategory.id);
            document.getElementById('categorySubtitle').textContent = `${categoryProducts.length} منتج متاح`;
            
            // Render products
            const grid = document.getElementById('productsGrid');
            grid.innerHTML = '';
            
            if (categoryProducts.length === 0) {
                grid.innerHTML = `
                    <div class="col-span-full text-center text-gray-300 py-12">
                        <i class="${selectedCategory.icon} text-6xl mb-6 text-white text-opacity-50"></i>
                        <h3 class="text-xl font-bold text-white mb-3">لا توجد منتجات حالياً</h3>
                        <p class="text-lg mb-4">في قسم ${selectedCategory.name}</p>
                        ${isAdmin ? '<button class="bg-blue-500 px-6 py-3 rounded-lg text-white hover:bg-blue-600 transition-all" onclick="showAddProductModal()"><i class="fas fa-plus ml-2"></i>إضافة منتج جديد</button>' : ''}
                    </div>
                `;
                return;
            }
            
            categoryProducts.forEach(product => {
                const finalPrice = product.price - (product.price * product.discount / 100);
                
                const card = document.createElement('div');
                card.className = 'glass p-4 rounded-xl transform transition-all duration-300 hover:scale-105 hover:shadow-2xl';
                
                card.innerHTML = `
                    <div class="text-center">
                        <div class="text-4xl mb-3">${product.image}</div>
                        <h3 class="text-lg font-bold text-white mb-2">${product.name}</h3>
                        
                        <div class="mb-3">
                            ${product.discount > 0 ? `
                                <div class="flex items-center justify-center gap-2">
                                    <span class="text-red-400 line-through text-sm">${product.price.toFixed(2)} ج.م</span>
                                    <span class="bg-red-500 text-white text-xs px-2 py-1 rounded-full">-${product.discount}%</span>
                                </div>
                                <div class="text-green-400 font-bold text-xl">${finalPrice.toFixed(2)} ج.م</div>
                            ` : `
                                <div class="text-green-400 font-bold text-xl">${product.price.toFixed(2)} ج.م</div>
                            `}
                        </div>
                        
                        <div class="mb-4">
                            <div class="flex items-center justify-center gap-2 text-sm">
                                <i class="fas fa-box text-blue-400"></i>
                                <span class="text-white">متوفر: ${product.stock}</span>
                            </div>
                        </div>
                        
                        <button onclick="addToCart(${product.id})" class="w-full bg-gradient-to-r from-green-500 to-green-600 p-3 rounded-lg text-white hover:from-green-600 hover:to-green-700 transition-all font-medium ${product.stock === 0 ? 'opacity-50 cursor-not-allowed' : ''}" ${product.stock === 0 ? 'disabled' : ''}>
                            <i class="fas fa-cart-plus ml-2"></i>
                            ${product.stock === 0 ? 'غير متوفر' : 'أضف للسلة'}
                        </button>
                    </div>
                `;
                
                grid.appendChild(card);
            });
        }

        function renderAdminSettings() {
            // Update all settings inputs
            document.getElementById('storeNameSetting').value = storeName;
            document.getElementById('adminEmailSetting').value = adminEmail;
            document.getElementById('adminPasswordSetting').value = adminPassword;
            document.getElementById('walletNumberSetting').value = walletNumber;
            document.getElementById('walletProviderSetting').value = walletProvider;
            
            // Update statistics
            document.getElementById('categoriesCount').textContent = categories.length;
            document.getElementById('productsCount').textContent = products.length;
            document.getElementById('availableProductsCount').textContent = products.filter(p => p.stock > 0).length;
        }

        function updateStoreName() {
            const newStoreName = document.getElementById('storeNameSetting').value.trim();
            if (!newStoreName) {
                showNotification('يرجى إدخال اسم المتجر! ⚠️', 'error');
                return;
            }
            
            storeName = newStoreName;
            
            // Update store name in all places
            document.getElementById('storeNameHeader').textContent = storeName;
            document.getElementById('pageTitle').textContent = `تسجيل الدخول - ${storeName}`;
            
            showNotification(`تم تحديث اسم المتجر إلى: ${storeName} ✅`, 'success');
        }

        function updateWalletSettings() {
            const newWalletNumber = document.getElementById('walletNumberSetting').value.trim();
            const newWalletProvider = document.getElementById('walletProviderSetting').value;
            
            if (!newWalletNumber) {
                showNotification('يرجى إدخال رقم المحفظة! ⚠️', 'error');
                return;
            }
            
            if (!/^01\d{9}$/.test(newWalletNumber)) {
                showNotification('رقم المحفظة يجب أن يبدأ بـ 01 ويتكون من 11 رقم! ⚠️', 'error');
                return;
            }
            
            walletNumber = newWalletNumber;
            walletProvider = newWalletProvider;
            
            const providerNames = {
                'vodafone': 'فودافون كاش',
                'etisalat': 'اتصالات كاش',
                'orange': 'أورانج كاش'
            };
            
            showNotification(`تم تحديث المحفظة إلى: ${walletNumber} (${providerNames[walletProvider]}) ✅`, 'success');
        }

        function showManageCategoriesModal() {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4';
            modal.innerHTML = `
                <div class="glass-dark p-6 rounded-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto">
                    <div class="text-center mb-6">
                        <i class="fas fa-th-large text-4xl text-purple-400 mb-3"></i>
                        <h2 class="text-2xl font-bold text-white">إدارة الأقسام</h2>
                        <p class="text-gray-300 text-sm mt-2">تعديل وحذف أقسام المتجر</p>
                    </div>
                    
                    <div class="space-y-4 mb-6">
                        ${categories.map((category, index) => `
                            <div class="glass p-4 rounded-lg">
                                <div class="flex items-center justify-between">
                                    <div class="flex items-center gap-4">
                                        <i class="${category.icon} text-2xl" style="color: ${category.color}"></i>
                                        <div>
                                            <h4 class="text-white font-medium">${category.name}</h4>
                                            <p class="text-gray-300 text-sm">${products.filter(p => p.categoryId === category.id).length} منتج</p>
                                        </div>
                                    </div>
                                    <div class="flex gap-2">
                                        <button onclick="editCategory(${index})" class="bg-blue-500 hover:bg-blue-600 text-white px-3 py-2 rounded-lg transition-all">
                                            <i class="fas fa-edit"></i>
                                        </button>
                                        <button onclick="deleteCategory(${index})" class="bg-red-500 hover:bg-red-600 text-white px-3 py-2 rounded-lg transition-all">
                                            <i class="fas fa-trash"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                    
                    <div class="flex gap-3">
                        <button onclick="showAddCategoryModal(); document.querySelector('.fixed.inset-0').remove();" class="flex-1 bg-gradient-to-r from-green-500 to-green-600 p-3 rounded-lg text-white hover:from-green-600 hover:to-green-700 transition-all font-medium">
                            <i class="fas fa-plus ml-2"></i>
                            إضافة قسم جديد
                        </button>
                        <button onclick="this.closest('.fixed').remove()" class="bg-gradient-to-r from-gray-500 to-gray-600 p-3 rounded-lg text-white hover:from-gray-600 hover:to-gray-700 transition-all font-medium">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
        }

        function showManageProductsModal() {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4';
            modal.innerHTML = `
                <div class="glass-dark p-6 rounded-2xl max-w-4xl w-full max-h-[90vh] overflow-y-auto">
                    <div class="text-center mb-6">
                        <i class="fas fa-boxes text-4xl text-orange-400 mb-3"></i>
                        <h2 class="text-2xl font-bold text-white">إدارة المنتجات</h2>
                        <p class="text-gray-300 text-sm mt-2">تعديل وحذف منتجات المتجر</p>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                        ${products.map((product, index) => `
                            <div class="glass p-4 rounded-lg">
                                <div class="flex items-center justify-between">
                                    <div class="flex items-center gap-3">
                                        <div class="text-2xl">${product.image}</div>
                                        <div>
                                            <h4 class="text-white font-medium">${product.name}</h4>
                                            <p class="text-gray-300 text-sm">${product.price.toFixed(2)} ج.م - المخزون: ${product.stock}</p>
                                            <p class="text-gray-400 text-xs">${categories.find(c => c.id === product.categoryId)?.name || 'غير محدد'}</p>
                                        </div>
                                    </div>
                                    <div class="flex gap-2">
                                        <button onclick="editProduct(${index})" class="bg-blue-500 hover:bg-blue-600 text-white px-3 py-2 rounded-lg transition-all">
                                            <i class="fas fa-edit"></i>
                                        </button>
                                        <button onclick="deleteProduct(${index})" class="bg-red-500 hover:bg-red-600 text-white px-3 py-2 rounded-lg transition-all">
                                            <i class="fas fa-trash"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                    
                    <div class="flex gap-3">
                        <button onclick="showAddProductModal(); document.querySelector('.fixed.inset-0').remove();" class="flex-1 bg-gradient-to-r from-green-500 to-green-600 p-3 rounded-lg text-white hover:from-green-600 hover:to-green-700 transition-all font-medium">
                            <i class="fas fa-plus ml-2"></i>
                            إضافة منتج جديد
                        </button>
                        <button onclick="this.closest('.fixed').remove()" class="bg-gradient-to-r from-gray-500 to-gray-600 p-3 rounded-lg text-white hover:from-gray-600 hover:to-gray-700 transition-all font-medium">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
        }

        function editCategory(index) {
            const category = categories[index];
            
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4';
            modal.innerHTML = `
                <div class="glass-dark p-6 rounded-2xl max-w-md w-full">
                    <div class="text-center mb-6">
                        <i class="fas fa-edit text-4xl text-blue-400 mb-3"></i>
                        <h2 class="text-2xl font-bold text-white">تعديل القسم</h2>
                        <p class="text-gray-300 text-sm mt-2">تعديل بيانات القسم</p>
                    </div>
                    
                    <div class="space-y-4">
                        <div>
                            <label class="block text-white text-sm font-medium mb-2">
                                <i class="fas fa-tag ml-2"></i>
                                اسم القسم *
                            </label>
                            <input type="text" id="editCategoryName" value="${category.name}" 
                                   class="w-full p-3 rounded-lg bg-white bg-opacity-20 text-white placeholder-gray-300 border border-white border-opacity-30 focus:border-blue-400 focus:outline-none transition-all">
                        </div>
                        
                        <div>
                            <label class="block text-white text-sm font-medium mb-2">
                                <i class="fas fa-icons ml-2"></i>
                                أيقونة القسم *
                            </label>
                            <select id="editCategoryIcon" class="w-full p-3 rounded-lg bg-white bg-opacity-20 text-white border border-white border-opacity-30 focus:border-blue-400 focus:outline-none transition-all">
                                <option value="fas fa-apple-alt" ${category.icon === 'fas fa-apple-alt' ? 'selected' : ''}>🍎 فواكه وخضروات</option>
                                <option value="fas fa-bread-slice" ${category.icon === 'fas fa-bread-slice' ? 'selected' : ''}>🍞 مخبوزات</option>
                                <option value="fas fa-fish" ${category.icon === 'fas fa-fish' ? 'selected' : ''}>🐟 أسماك ولحوم</option>
                                <option value="fas fa-coffee" ${category.icon === 'fas fa-coffee' ? 'selected' : ''}>☕ مشروبات</option>
                                <option value="fas fa-candy-cane" ${category.icon === 'fas fa-candy-cane' ? 'selected' : ''}>🍭 حلويات</option>
                                <option value="fas fa-prescription-bottle" ${category.icon === 'fas fa-prescription-bottle' ? 'selected' : ''}>💊 صحة وجمال</option>
                                <option value="fas fa-baby" ${category.icon === 'fas fa-baby' ? 'selected' : ''}>👶 منتجات الأطفال</option>
                                <option value="fas fa-tshirt" ${category.icon === 'fas fa-tshirt' ? 'selected' : ''}>👕 ملابس</option>
                                <option value="fas fa-home" ${category.icon === 'fas fa-home' ? 'selected' : ''}>🏠 منزلية</option>
                                <option value="fas fa-tools" ${category.icon === 'fas fa-tools' ? 'selected' : ''}>🔧 أدوات</option>
                                <option value="fas fa-graduation-cap" ${category.icon === 'fas fa-graduation-cap' ? 'selected' : ''}>🎓 أدوات مدرسية</option>
                                <option value="fas fa-book" ${category.icon === 'fas fa-book' ? 'selected' : ''}>📚 كتب ومجلات</option>
                                <option value="fas fa-gamepad" ${category.icon === 'fas fa-gamepad' ? 'selected' : ''}>🎮 ألعاب وترفيه</option>
                                <option value="fas fa-car" ${category.icon === 'fas fa-car' ? 'selected' : ''}>🚗 سيارات وقطع غيار</option>
                                <option value="fas fa-mobile-alt" ${category.icon === 'fas fa-mobile-alt' ? 'selected' : ''}>📱 إلكترونيات</option>
                                <option value="fas fa-dumbbell" ${category.icon === 'fas fa-dumbbell' ? 'selected' : ''}>💪 رياضة ولياقة</option>
                                <option value="fas fa-paw" ${category.icon === 'fas fa-paw' ? 'selected' : ''}>🐾 حيوانات أليفة</option>
                                <option value="fas fa-seedling" ${category.icon === 'fas fa-seedling' ? 'selected' : ''}>🌱 نباتات وحدائق</option>
                                <option value="fas fa-gift" ${category.icon === 'fas fa-gift' ? 'selected' : ''}>🎁 هدايا ومناسبات</option>
                                <option value="fas fa-utensils" ${category.icon === 'fas fa-utensils' ? 'selected' : ''}>🍴 أدوات مطبخ</option>
                                <option value="fas fa-couch" ${category.icon === 'fas fa-couch' ? 'selected' : ''}>🛋️ أثاث</option>
                                <option value="fas fa-paint-brush" ${category.icon === 'fas fa-paint-brush' ? 'selected' : ''}>🎨 فنون وحرف</option>
                                <option value="fas fa-music" ${category.icon === 'fas fa-music' ? 'selected' : ''}>🎵 موسيقى</option>
                                <option value="fas fa-camera" ${category.icon === 'fas fa-camera' ? 'selected' : ''}>📷 تصوير</option>
                                <option value="fas fa-bicycle" ${category.icon === 'fas fa-bicycle' ? 'selected' : ''}>🚲 دراجات</option>
                            </select>
                        </div>
                        
                        <div>
                            <label class="block text-white text-sm font-medium mb-2">
                                <i class="fas fa-palette ml-2"></i>
                                لون القسم *
                            </label>
                            <div class="grid grid-cols-6 gap-2">
                                ${['#FF6B6B', '#4ECDC4', '#45B7D1', '#96CEB4', '#FFEAA7', '#DDA0DD', '#98D8C8', '#F7DC6F', '#BB8FCE', '#85C1E9', '#F8C471', '#82E0AA'].map(color => `
                                    <button type="button" onclick="selectEditCategoryColor('${color}')" 
                                            class="w-10 h-10 rounded-lg border-2 border-white border-opacity-30 hover:border-opacity-60 transition-all edit-category-color-btn ${category.color === color ? 'ring-4 ring-white' : ''}" 
                                            style="background-color: ${color}" data-color="${color}">
                                    </button>
                                `).join('')}
                            </div>
                            <input type="hidden" id="selectedEditCategoryColor" value="${category.color}">
                        </div>
                    </div>
                    
                    <div class="flex gap-3 mt-6">
                        <button onclick="saveEditedCategory(${index})" class="flex-1 bg-gradient-to-r from-blue-500 to-blue-600 p-3 rounded-lg text-white hover:from-blue-600 hover:to-blue-700 transition-all font-medium">
                            <i class="fas fa-save ml-2"></i>
                            حفظ التعديلات
                        </button>
                        <button onclick="this.closest('.fixed').remove()" class="bg-gradient-to-r from-gray-500 to-gray-600 p-3 rounded-lg text-white hover:from-gray-600 hover:to-gray-700 transition-all font-medium">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
        }

        function deleteCategory(index) {
            const category = categories[index];
            const categoryProducts = products.filter(p => p.categoryId === category.id);
            
            if (categoryProducts.length > 0) {
                showNotification(`لا يمكن حذف القسم لأنه يحتوي على ${categoryProducts.length} منتج! ⚠️`, 'error');
                return;
            }
            
            if (confirm(`هل أنت متأكد من حذف قسم "${category.name}"؟`)) {
                categories.splice(index, 1);
                showNotification(`تم حذف قسم "${category.name}" بنجاح! ✅`, 'success');
                
                // Close modal and refresh
                document.querySelector('.fixed.inset-0').remove();
                if (currentPage === 'categories') {
                    renderCategories();
                }
            }
        }

        function selectEditCategoryColor(color) {
            // Remove previous selection
            document.querySelectorAll('.edit-category-color-btn').forEach(btn => {
                btn.classList.remove('ring-4', 'ring-white');
            });
            
            // Add selection to clicked button
            event.target.classList.add('ring-4', 'ring-white');
            document.getElementById('selectedEditCategoryColor').value = color;
        }

        function saveEditedCategory(index) {
            const name = document.getElementById('editCategoryName').value.trim();
            const icon = document.getElementById('editCategoryIcon').value;
            const color = document.getElementById('selectedEditCategoryColor').value;
            
            if (!name) {
                showNotification('يرجى إدخال اسم القسم! ⚠️', 'error');
                return;
            }
            
            // Update category
            categories[index].name = name;
            categories[index].icon = icon;
            categories[index].color = color;
            
            showNotification(`تم تحديث قسم "${name}" بنجاح! ✅`, 'success');
            document.querySelector('.fixed.inset-0').remove();
            
            // Refresh current page
            if (currentPage === 'categories') {
                renderCategories();
            } else if (currentPage === 'products') {
                renderProducts();
            }
        }

        function editProduct(index) {
            const product = products[index];
            
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4';
            modal.innerHTML = `
                <div class="glass-dark p-6 rounded-2xl max-w-lg w-full max-h-[90vh] overflow-y-auto">
                    <div class="text-center mb-6">
                        <i class="fas fa-edit text-4xl text-orange-400 mb-3"></i>
                        <h2 class="text-2xl font-bold text-white">تعديل المنتج</h2>
                        <p class="text-gray-300 text-sm mt-2">تعديل بيانات المنتج</p>
                    </div>
                    
                    <div class="space-y-4">
                        <div>
                            <label class="block text-white text-sm font-medium mb-2">
                                <i class="fas fa-box ml-2"></i>
                                اسم المنتج *
                            </label>
                            <input type="text" id="editProductName" value="${product.name}" 
                                   class="w-full p-3 rounded-lg bg-white bg-opacity-20 text-white placeholder-gray-300 border border-white border-opacity-30 focus:border-orange-400 focus:outline-none transition-all">
                        </div>
                        
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="block text-white text-sm font-medium mb-2">
                                    <i class="fas fa-money-bill ml-2"></i>
                                    السعر (ج.م) *
                                </label>
                                <input type="number" id="editProductPrice" value="${product.price}" step="0.01" min="0"
                                       class="w-full p-3 rounded-lg bg-white bg-opacity-20 text-white placeholder-gray-300 border border-white border-opacity-30 focus:border-orange-400 focus:outline-none transition-all">
                            </div>
                            
                            <div>
                                <label class="block text-white text-sm font-medium mb-2">
                                    <i class="fas fa-warehouse ml-2"></i>
                                    المخزون *
                                </label>
                                <input type="number" id="editProductStock" value="${product.stock}" min="0"
                                       class="w-full p-3 rounded-lg bg-white bg-opacity-20 text-white placeholder-gray-300 border border-white border-opacity-30 focus:border-orange-400 focus:outline-none transition-all">
                            </div>
                        </div>
                        
                        <div>
                            <label class="block text-white text-sm font-medium mb-2">
                                <i class="fas fa-percentage ml-2"></i>
                                نسبة الخصم (%)
                            </label>
                            <input type="number" id="editProductDiscount" value="${product.discount}" min="0" max="100"
                                   class="w-full p-3 rounded-lg bg-white bg-opacity-20 text-white placeholder-gray-300 border border-white border-opacity-30 focus:border-orange-400 focus:outline-none transition-all">
                        </div>
                        
                        <div>
                            <label class="block text-white text-sm font-medium mb-2">
                                <i class="fas fa-list ml-2"></i>
                                القسم *
                            </label>
                            <select id="editProductCategory" class="w-full p-3 rounded-lg bg-white bg-opacity-20 text-white border border-white border-opacity-30 focus:border-orange-400 focus:outline-none transition-all">
                                ${categories.map(category => `
                                    <option value="${category.id}" ${product.categoryId === category.id ? 'selected' : ''}>${category.name}</option>
                                `).join('')}
                            </select>
                        </div>
                        
                        <div>
                            <label class="block text-white text-sm font-medium mb-2">
                                <i class="fas fa-smile ml-2"></i>
                                رمز المنتج (إيموجي) *
                            </label>
                            <div class="grid grid-cols-8 gap-2 mb-3">
                                ${['🍎', '🍌', '🥕', '🥬', '🍞', '🥛', '🧀', '🥩', '🐟', '🍚', '🥫', '🍯', '🧼', '🧴', '🍪', '🍫', '✏️', '📓', '📏', '✂️'].map(emoji => `
                                    <button type="button" onclick="selectEditProductEmoji('${emoji}')" 
                                            class="w-10 h-10 text-2xl rounded-lg border-2 border-white border-opacity-30 hover:border-opacity-60 transition-all edit-product-emoji-btn bg-white bg-opacity-10 ${product.image === emoji ? 'ring-4 ring-white' : ''}" 
                                            data-emoji="${emoji}">
                                        ${emoji}
                                    </button>
                                `).join('')}
                            </div>
                            <input type="hidden" id="selectedEditProductEmoji" value="${product.image}">
                        </div>
                    </div>
                    
                    <div class="flex gap-3 mt-6">
                        <button onclick="saveEditedProduct(${index})" class="flex-1 bg-gradient-to-r from-orange-500 to-orange-600 p-3 rounded-lg text-white hover:from-orange-600 hover:to-orange-700 transition-all font-medium">
                            <i class="fas fa-save ml-2"></i>
                            حفظ التعديلات
                        </button>
                        <button onclick="this.closest('.fixed').remove()" class="bg-gradient-to-r from-gray-500 to-gray-600 p-3 rounded-lg text-white hover:from-gray-600 hover:to-gray-700 transition-all font-medium">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
        }

        function selectEditProductEmoji(emoji) {
            // Remove previous selection
            document.querySelectorAll('.edit-product-emoji-btn').forEach(btn => {
                btn.classList.remove('ring-4', 'ring-white');
            });
            
            // Add selection to clicked button
            event.target.classList.add('ring-4', 'ring-white');
            document.getElementById('selectedEditProductEmoji').value = emoji;
        }

        function saveEditedProduct(index) {
            const name = document.getElementById('editProductName').value.trim();
            const price = parseFloat(document.getElementById('editProductPrice').value);
            const stock = parseInt(document.getElementById('editProductStock').value);
            const discount = parseInt(document.getElementById('editProductDiscount').value) || 0;
            const categoryId = parseInt(document.getElementById('editProductCategory').value);
            const emoji = document.getElementById('selectedEditProductEmoji').value;
            
            if (!name) {
                showNotification('يرجى إدخال اسم المنتج! ⚠️', 'error');
                return;
            }
            
            if (!price || price <= 0) {
                showNotification('يرجى إدخال سعر صحيح للمنتج! ⚠️', 'error');
                return;
            }
            
            if (stock < 0) {
                showNotification('يرجى إدخال كمية مخزون صحيحة! ⚠️', 'error');
                return;
            }
            
            if (!categoryId) {
                showNotification('يرجى اختيار قسم للمنتج! ⚠️', 'error');
                return;
            }
            
            if (!emoji) {
                showNotification('يرجى اختيار رمز للمنتج! ⚠️', 'error');
                return;
            }
            
            // Update product
            products[index].name = name;
            products[index].price = price;
            products[index].stock = stock;
            products[index].discount = discount;
            products[index].categoryId = categoryId;
            products[index].image = emoji;
            
            showNotification(`تم تحديث منتج "${name}" بنجاح! ✅`, 'success');
            document.querySelector('.fixed.inset-0').remove();
            
            // Refresh current page
            if (currentPage === 'categories') {
                renderCategories();
            } else if (currentPage === 'products') {
                renderProducts();
            }
        }

        function deleteProduct(index) {
            const product = products[index];
            
            if (confirm(`هل أنت متأكد من حذف منتج "${product.name}"؟`)) {
                products.splice(index, 1);
                showNotification(`تم حذف منتج "${product.name}" بنجاح! ✅`, 'success');
                
                // Close modal and refresh
                document.querySelector('.fixed.inset-0').remove();
                if (currentPage === 'products') {
                    renderProducts();
                } else if (currentPage === 'categories') {
                    renderCategories();
                }
            }
        }

        function addToCart(productId) {
            const product = products.find(p => p.id === productId);
            if (!product || product.stock === 0) {
                showNotification('المنتج غير متوفر! ❌', 'error');
                return;
            }
            
            // Check if product already in cart
            const existingItem = cart.find(item => item.id === productId);
            if (existingItem) {
                existingItem.quantity += 1;
            } else {
                cart.push({
                    id: product.id,
                    name: product.name,
                    price: product.price - (product.price * product.discount / 100),
                    quantity: 1,
                    image: product.image
                });
            }
            
            // Update stock
            product.stock -= 1;
            
            updateCartBadge();
            showNotification(`تم إضافة ${product.name} للسلة! 🛒`, 'success');
            
            // Re-render products to update stock display
            if (currentPage === 'products') {
                renderProducts();
            }
        }

        function updateAdminEmail() {
            const newEmail = document.getElementById('adminEmailSetting').value.trim();
            if (!newEmail || !isValidEmail(newEmail)) {
                showNotification('يرجى إدخال إيميل صحيح! ⚠️', 'error');
                return;
            }
            
            adminEmail = newEmail;
            showNotification(`تم تحديث إيميل المدير إلى: ${adminEmail} ✅`, 'success');
        }

        function updateAdminPassword() {
            const newPassword = document.getElementById('adminPasswordSetting').value.trim();
            if (!newPassword) {
                showNotification('يرجى إدخال كلمة مرور! ⚠️', 'error');
                return;
            }
            
            if (newPassword.length < 6) {
                showNotification('كلمة المرور يجب أن تكون 6 أحرف على الأقل! ⚠️', 'error');
                return;
            }
            
            adminPassword = newPassword;
            showNotification('تم تحديث كلمة مرور المدير بنجاح! ✅', 'success');
        }

        function showAddCategoryModal() {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4';
            modal.innerHTML = `
                <div class="glass-dark p-6 rounded-2xl max-w-md w-full">
                    <div class="text-center mb-6">
                        <i class="fas fa-plus-circle text-4xl text-green-400 mb-3"></i>
                        <h2 class="text-2xl font-bold text-white">إضافة قسم جديد</h2>
                        <p class="text-gray-300 text-sm mt-2">أضف قسماً جديداً لمتجرك</p>
                    </div>
                    
                    <div class="space-y-4">
                        <div>
                            <label class="block text-white text-sm font-medium mb-2">
                                <i class="fas fa-tag ml-2"></i>
                                اسم القسم *
                            </label>
                            <input type="text" id="newCategoryName" placeholder="مثال: الخضروات والفواكه" 
                                   class="w-full p-3 rounded-lg bg-white bg-opacity-20 text-white placeholder-gray-300 border border-white border-opacity-30 focus:border-green-400 focus:outline-none transition-all">
                        </div>
                        
                        <div>
                            <label class="block text-white text-sm font-medium mb-2">
                                <i class="fas fa-icons ml-2"></i>
                                أيقونة القسم *
                            </label>
                            <select id="newCategoryIcon" class="w-full p-3 rounded-lg bg-white bg-opacity-20 text-white border border-white border-opacity-30 focus:border-green-400 focus:outline-none transition-all">
                                <option value="">اختر أيقونة</option>
                                <option value="fas fa-apple-alt">🍎 فواكه وخضروات</option>
                                <option value="fas fa-bread-slice">🍞 مخبوزات</option>
                                <option value="fas fa-fish">🐟 أسماك ولحوم</option>
                                <option value="fas fa-coffee">☕ مشروبات</option>
                                <option value="fas fa-candy-cane">🍭 حلويات</option>
                                <option value="fas fa-prescription-bottle">💊 صحة وجمال</option>
                                <option value="fas fa-baby">👶 منتجات الأطفال</option>
                                <option value="fas fa-tshirt">👕 ملابس</option>
                                <option value="fas fa-home">🏠 منزلية</option>
                                <option value="fas fa-tools">🔧 أدوات</option>
                                <option value="fas fa-graduation-cap">🎓 أدوات مدرسية</option>
                                <option value="fas fa-book">📚 كتب ومجلات</option>
                                <option value="fas fa-gamepad">🎮 ألعاب وترفيه</option>
                                <option value="fas fa-car">🚗 سيارات وقطع غيار</option>
                                <option value="fas fa-mobile-alt">📱 إلكترونيات</option>
                                <option value="fas fa-dumbbell">💪 رياضة ولياقة</option>
                                <option value="fas fa-paw">🐾 حيوانات أليفة</option>
                                <option value="fas fa-seedling">🌱 نباتات وحدائق</option>
                                <option value="fas fa-gift">🎁 هدايا ومناسبات</option>
                                <option value="fas fa-utensils">🍴 أدوات مطبخ</option>
                                <option value="fas fa-couch">🛋️ أثاث</option>
                                <option value="fas fa-paint-brush">🎨 فنون وحرف</option>
                                <option value="fas fa-music">🎵 موسيقى</option>
                                <option value="fas fa-camera">📷 تصوير</option>
                                <option value="fas fa-bicycle">🚲 دراجات</option>
                            </select>
                        </div>
                        
                        <div>
                            <label class="block text-white text-sm font-medium mb-2">
                                <i class="fas fa-palette ml-2"></i>
                                لون القسم *
                            </label>
                            <div class="grid grid-cols-6 gap-2">
                                ${['#FF6B6B', '#4ECDC4', '#45B7D1', '#96CEB4', '#FFEAA7', '#DDA0DD', '#98D8C8', '#F7DC6F', '#BB8FCE', '#85C1E9', '#F8C471', '#82E0AA'].map(color => `
                                    <button type="button" onclick="selectCategoryColor('${color}')" 
                                            class="w-10 h-10 rounded-lg border-2 border-white border-opacity-30 hover:border-opacity-60 transition-all category-color-btn" 
                                            style="background-color: ${color}" data-color="${color}">
                                    </button>
                                `).join('')}
                            </div>
                            <input type="hidden" id="selectedCategoryColor" value="">
                        </div>
                    </div>
                    
                    <div class="flex gap-3 mt-6">
                        <button id="saveCategoryBtn" class="flex-1 bg-gradient-to-r from-green-500 to-green-600 p-3 rounded-lg text-white hover:from-green-600 hover:to-green-700 transition-all font-medium">
                            <i class="fas fa-save ml-2"></i>
                            حفظ القسم
                        </button>
                        <button onclick="this.closest('.fixed').remove()" class="bg-gradient-to-r from-gray-500 to-gray-600 p-3 rounded-lg text-white hover:from-gray-600 hover:to-gray-700 transition-all font-medium">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            // Add event listener for save button
            document.getElementById('saveCategoryBtn').addEventListener('click', () => {
                const name = document.getElementById('newCategoryName').value.trim();
                const icon = document.getElementById('newCategoryIcon').value;
                const color = document.getElementById('selectedCategoryColor').value;
                
                if (!name) {
                    showNotification('يرجى إدخال اسم القسم! ⚠️', 'error');
                    return;
                }
                
                if (!icon) {
                    showNotification('يرجى اختيار أيقونة للقسم! ⚠️', 'error');
                    return;
                }
                
                if (!color) {
                    showNotification('يرجى اختيار لون للقسم! ⚠️', 'error');
                    return;
                }
                
                // Add new category
                const newId = Math.max(...categories.map(c => c.id), 0) + 1;
                categories.push({
                    id: newId,
                    name: name,
                    icon: icon,
                    color: color
                });
                
                showNotification(`تم إضافة قسم "${name}" بنجاح! ✅`, 'success');
                modal.remove();
                
                // Refresh categories if on categories page
                if (currentPage === 'categories') {
                    renderCategories();
                }
            });
        }

        function selectCategoryColor(color) {
            // Remove previous selection
            document.querySelectorAll('.category-color-btn').forEach(btn => {
                btn.classList.remove('ring-4', 'ring-white');
            });
            
            // Add selection to clicked button
            event.target.classList.add('ring-4', 'ring-white');
            document.getElementById('selectedCategoryColor').value = color;
        }

        function showAddProductModal() {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4';
            modal.innerHTML = `
                <div class="glass-dark p-6 rounded-2xl max-w-lg w-full max-h-[90vh] overflow-y-auto">
                    <div class="text-center mb-6">
                        <i class="fas fa-plus-circle text-4xl text-orange-400 mb-3"></i>
                        <h2 class="text-2xl font-bold text-white">إضافة منتج جديد</h2>
                        <p class="text-gray-300 text-sm mt-2">أضف منتجاً جديداً لمتجرك</p>
                    </div>
                    
                    <div class="space-y-4">
                        <div>
                            <label class="block text-white text-sm font-medium mb-2">
                                <i class="fas fa-box ml-2"></i>
                                اسم المنتج *
                            </label>
                            <input type="text" id="newProductName" placeholder="مثال: تفاح أحمر" 
                                   class="w-full p-3 rounded-lg bg-white bg-opacity-20 text-white placeholder-gray-300 border border-white border-opacity-30 focus:border-orange-400 focus:outline-none transition-all">
                        </div>
                        
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="block text-white text-sm font-medium mb-2">
                                    <i class="fas fa-money-bill ml-2"></i>
                                    السعر (ج.م) *
                                </label>
                                <input type="number" id="newProductPrice" placeholder="0.00" step="0.01" min="0"
                                       class="w-full p-3 rounded-lg bg-white bg-opacity-20 text-white placeholder-gray-300 border border-white border-opacity-30 focus:border-orange-400 focus:outline-none transition-all">
                            </div>
                            
                            <div>
                                <label class="block text-white text-sm font-medium mb-2">
                                    <i class="fas fa-warehouse ml-2"></i>
                                    المخزون *
                                </label>
                                <input type="number" id="newProductStock" placeholder="0" min="0"
                                       class="w-full p-3 rounded-lg bg-white bg-opacity-20 text-white placeholder-gray-300 border border-white border-opacity-30 focus:border-orange-400 focus:outline-none transition-all">
                            </div>
                        </div>
                        
                        <div>
                            <label class="block text-white text-sm font-medium mb-2">
                                <i class="fas fa-percentage ml-2"></i>
                                نسبة الخصم (%)
                            </label>
                            <input type="number" id="newProductDiscount" placeholder="0" min="0" max="100"
                                   class="w-full p-3 rounded-lg bg-white bg-opacity-20 text-white placeholder-gray-300 border border-white border-opacity-30 focus:border-orange-400 focus:outline-none transition-all">
                        </div>
                        
                        <div>
                            <label class="block text-white text-sm font-medium mb-2">
                                <i class="fas fa-list ml-2"></i>
                                القسم *
                            </label>
                            <select id="newProductCategory" class="w-full p-3 rounded-lg bg-white bg-opacity-20 text-white border border-white border-opacity-30 focus:border-orange-400 focus:outline-none transition-all">
                                <option value="">اختر القسم</option>
                                ${categories.map(category => `
                                    <option value="${category.id}">${category.name}</option>
                                `).join('')}
                            </select>
                        </div>
                        
                        <div>
                            <label class="block text-white text-sm font-medium mb-2">
                                <i class="fas fa-smile ml-2"></i>
                                رمز المنتج (إيموجي) *
                            </label>
                            <div class="grid grid-cols-8 gap-2 mb-3">
                                ${['🍎', '🍌', '🥕', '🥬', '🍞', '🥛', '🧀', '🥩', '🐟', '🍚', '🥫', '🍯', '🧼', '🧴', '🍪', '🍫', '✏️', '📓', '📏', '🧽', '✂️', '📚', '🎒', '🖊️'].map(emoji => `
                                    <button type="button" onclick="selectProductEmoji('${emoji}')" 
                                            class="w-10 h-10 text-2xl rounded-lg border-2 border-white border-opacity-30 hover:border-opacity-60 transition-all product-emoji-btn bg-white bg-opacity-10" 
                                            data-emoji="${emoji}">
                                        ${emoji}
                                    </button>
                                `).join('')}
                            </div>
                            <input type="hidden" id="selectedProductEmoji" value="">
                        </div>
                    </div>
                    
                    <div class="flex gap-3 mt-6">
                        <button id="saveProductBtn" class="flex-1 bg-gradient-to-r from-orange-500 to-orange-600 p-3 rounded-lg text-white hover:from-orange-600 hover:to-orange-700 transition-all font-medium">
                            <i class="fas fa-save ml-2"></i>
                            حفظ المنتج
                        </button>
                        <button onclick="this.closest('.fixed').remove()" class="bg-gradient-to-r from-gray-500 to-gray-600 p-3 rounded-lg text-white hover:from-gray-600 hover:to-gray-700 transition-all font-medium">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            // Add event listener for save button
            document.getElementById('saveProductBtn').addEventListener('click', () => {
                const name = document.getElementById('newProductName').value.trim();
                const price = parseFloat(document.getElementById('newProductPrice').value);
                const stock = parseInt(document.getElementById('newProductStock').value);
                const discount = parseInt(document.getElementById('newProductDiscount').value) || 0;
                const categoryId = parseInt(document.getElementById('newProductCategory').value);
                const emoji = document.getElementById('selectedProductEmoji').value;
                
                if (!name) {
                    showNotification('يرجى إدخال اسم المنتج! ⚠️', 'error');
                    return;
                }
                
                if (!price || price <= 0) {
                    showNotification('يرجى إدخال سعر صحيح للمنتج! ⚠️', 'error');
                    return;
                }
                
                if (!stock || stock < 0) {
                    showNotification('يرجى إدخال كمية المخزون! ⚠️', 'error');
                    return;
                }
                
                if (!categoryId) {
                    showNotification('يرجى اختيار قسم للمنتج! ⚠️', 'error');
                    return;
                }
                
                if (!emoji) {
                    showNotification('يرجى اختيار رمز للمنتج! ⚠️', 'error');
                    return;
                }
                
                // Add new product
                const newId = Math.max(...products.map(p => p.id), 0) + 1;
                products.push({
                    id: newId,
                    name: name,
                    price: price,
                    stock: stock,
                    discount: discount,
                    categoryId: categoryId,
                    image: emoji
                });
                
                showNotification(`تم إضافة منتج "${name}" بنجاح! ✅`, 'success');
                modal.remove();
                
                // Refresh current page
                if (currentPage === 'categories') {
                    renderCategories();
                } else if (currentPage === 'products') {
                    renderProducts();
                }
            });
        }

        function selectProductEmoji(emoji) {
            // Remove previous selection
            document.querySelectorAll('.product-emoji-btn').forEach(btn => {
                btn.classList.remove('ring-4', 'ring-white');
            });
            
            // Add selection to clicked button
            event.target.classList.add('ring-4', 'ring-white');
            document.getElementById('selectedProductEmoji').value = emoji;
        }

        function isValidEmail(email) {
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            return emailRegex.test(email);
        }

        function showNotification(message, type = 'info') {
            // Remove existing notifications
            const existingNotifications = document.querySelectorAll('.notification');
            existingNotifications.forEach(notification => notification.remove());
            
            // Create new notification
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.innerHTML = `
                <div class="flex items-center gap-3">
                    <i class="fas ${getNotificationIcon(type)} text-lg"></i>
                    <span>${message}</span>
                </div>
            `;
            
            document.body.appendChild(notification);
            
            // Show notification
            setTimeout(() => {
                notification.classList.add('show');
            }, 100);
            
            // Hide notification after 4 seconds
            setTimeout(() => {
                notification.classList.remove('show');
                setTimeout(() => {
                    notification.remove();
                }, 300);
            }, 4000);
        }

        function getNotificationIcon(type) {
            switch(type) {
                case 'success':
                    return 'fa-check-circle';
                case 'error':
                    return 'fa-exclamation-circle';
                case 'info':
                default:
                    return 'fa-info-circle';
            }
        }

        function showCategoryProducts(category) {
            showNotification(`عرض منتجات ${category.name}! 📦`, 'info');
            
            // Here you would typically navigate to products page
            // For now, we'll just show a notification
            setTimeout(() => {
                const categoryProducts = products.filter(p => p.categoryId === category.id);
                if (categoryProducts.length > 0) {
                    showNotification(`تم العثور على ${categoryProducts.length} منتج في ${category.name}`, 'success');
                } else {
                    showNotification(`لا توجد منتجات في ${category.name} حالياً`, 'info');
                }
            }, 1000);
        }

        function showAdminSettings() {
            // Create admin settings modal
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4';
            modal.innerHTML = `
                <div class="glass-dark p-6 rounded-2xl max-w-md w-full">
                    <div class="text-center mb-6">
                        <i class="fas fa-crown text-4xl text-yellow-400 mb-3"></i>
                        <h2 class="text-2xl font-bold text-white">إعدادات المدير</h2>
                        <p class="text-gray-300 text-sm mt-2">تحكم في إعدادات النظام</p>
                    </div>
                    
                    <div class="space-y-4">
                        <div>
                            <label class="block text-white text-sm font-medium mb-2">
                                <i class="fas fa-envelope ml-2"></i>
                                إيميل المدير (جوجل)
                            </label>
                            <input type="email" id="adminEmailInput" value="${adminEmail}" 
                                   class="w-full p-3 rounded-lg bg-white bg-opacity-20 text-white placeholder-gray-300 border border-white border-opacity-30 focus:border-blue-400 focus:outline-none transition-all">
                            <p class="text-gray-400 text-xs mt-1">الإيميل الذي سيحصل على صلاحيات المدير عند تسجيل الدخول بجوجل</p>
                        </div>
                        
                        <div class="flex gap-3 pt-4">
                            <button id="saveAdminSettings" class="flex-1 bg-gradient-to-r from-green-500 to-green-600 p-3 rounded-lg text-white hover:from-green-600 hover:to-green-700 transition-all font-medium">
                                <i class="fas fa-save ml-2"></i>
                                حفظ
                            </button>
                            <button id="cancelAdminSettings" class="flex-1 bg-gradient-to-r from-gray-500 to-gray-600 p-3 rounded-lg text-white hover:from-gray-600 hover:to-gray-700 transition-all font-medium">
                                <i class="fas fa-times ml-2"></i>
                                إلغاء
                            </button>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            // Add event listeners
            document.getElementById('saveAdminSettings').addEventListener('click', () => {
                const newAdminEmail = document.getElementById('adminEmailInput').value.trim();
                if (newAdminEmail && isValidEmail(newAdminEmail)) {
                    adminEmail = newAdminEmail;
                    showNotification(`تم تحديث إيميل المدير إلى: ${adminEmail} ✅`, 'success');
                    modal.remove();
                } else {
                    showNotification('يرجى إدخال إيميل صحيح! ⚠️', 'error');
                }
            });
            
            document.getElementById('cancelAdminSettings').addEventListener('click', () => {
                modal.remove();
            });
            
            // Close modal when clicking outside
            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    modal.remove();
                }
            });
        }

        function showCart() {
            // Create cart modal
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4';
            
            if (cart.length === 0) {
                modal.innerHTML = `
                    <div class="glass-dark p-6 rounded-2xl max-w-md w-full">
                        <div class="text-center">
                            <i class="fas fa-shopping-cart text-6xl text-gray-400 mb-4"></i>
                            <h2 class="text-2xl font-bold text-white mb-3">السلة فارغة</h2>
                            <p class="text-gray-300 mb-6">لم تقم بإضافة أي منتجات بعد</p>
                            <button id="closeEmptyCartBtn" class="bg-gradient-to-r from-blue-500 to-blue-600 px-6 py-3 rounded-lg text-white hover:from-blue-600 hover:to-blue-700 transition-all font-medium">
                                <i class="fas fa-arrow-right ml-2"></i>
                                متابعة التسوق
                            </button>
                        </div>
                    </div>
                `;
            } else {
                modal.innerHTML = `
                    <div class="glass-dark p-6 rounded-2xl max-w-2xl w-full max-h-[90vh] flex flex-col">
                        <!-- Header -->
                        <div class="text-center mb-6">
                            <i class="fas fa-shopping-cart text-4xl text-blue-400 mb-3"></i>
                            <h2 class="text-2xl font-bold text-white">سلة التسوق</h2>
                            <p class="text-gray-300 text-sm mt-2">${cart.length} منتج في السلة</p>
                        </div>
                        
                        <!-- Products List with Scroll -->
                        <div class="flex-1 overflow-y-auto mb-6 max-h-64" style="scrollbar-width: thin; scrollbar-color: rgba(255,255,255,0.3) transparent;">
                            <div class="space-y-3 pr-2">
                                ${cart.map((item, index) => `
                                    <div class="glass p-3 rounded-lg">
                                        <div class="flex justify-between items-center">
                                            <div class="flex items-center gap-3">
                                                <div class="text-2xl">${item.image}</div>
                                                <div>
                                                    <h4 class="text-white font-medium text-sm">${item.name}</h4>
                                                    <div class="flex items-center gap-3 mt-1">
                                                        <div class="flex items-center gap-1">
                                                            <button onclick="decreaseQuantity(${index})" class="bg-red-500 hover:bg-red-600 text-white w-6 h-6 rounded-full flex items-center justify-center transition-all">
                                                                <i class="fas fa-minus text-xs"></i>
                                                            </button>
                                                            <span class="text-white font-bold text-sm px-2">${item.quantity}</span>
                                                            <button onclick="increaseQuantity(${index})" class="bg-green-500 hover:bg-green-600 text-white w-6 h-6 rounded-full flex items-center justify-center transition-all">
                                                                <i class="fas fa-plus text-xs"></i>
                                                            </button>
                                                        </div>
                                                        <span class="text-gray-300 text-xs">× ${item.price.toFixed(2)} ج.م</span>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="text-left">
                                                <p class="text-green-400 font-bold text-lg">${(item.price * item.quantity).toFixed(2)} ج.م</p>
                                                <button onclick="removeFromCart(${index})" class="text-red-400 hover:text-red-300 text-xs mt-1 bg-red-500 bg-opacity-20 px-2 py-1 rounded-full transition-all hover:bg-opacity-30">
                                                    <i class="fas fa-trash ml-1"></i> حذف
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                        
                        <!-- Total -->
                        <div class="border-t border-white border-opacity-20 pt-4 mb-6">
                            <div class="flex justify-between items-center text-white bg-gradient-to-r from-green-500 to-green-600 p-4 rounded-lg">
                                <span class="text-xl font-bold">المجموع الكلي:</span>
                                <span class="text-2xl font-bold">${cart.reduce((total, item) => total + (item.price * item.quantity), 0).toFixed(2)} ج.م</span>
                            </div>
                        </div>
                        
                        <!-- Action Buttons -->
                        <div class="flex gap-3">
                            <button id="checkoutBtn" class="flex-1 bg-gradient-to-r from-blue-500 to-blue-600 p-4 rounded-lg text-white hover:from-blue-600 hover:to-blue-700 transition-all font-medium text-lg">
                                <i class="fas fa-credit-card ml-2"></i>
                                إتمام الشراء
                            </button>
                            <button id="closeCartBtn" class="bg-gradient-to-r from-gray-500 to-gray-600 p-4 rounded-lg text-white hover:from-gray-600 hover:to-gray-700 transition-all font-medium">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                    </div>
                `;
            }
            
            document.body.appendChild(modal);
            
            // Add event listeners
            if (cart.length === 0) {
                document.getElementById('closeEmptyCartBtn').addEventListener('click', () => {
                    modal.remove();
                });
            } else {
                document.getElementById('checkoutBtn').addEventListener('click', () => {
                    modal.remove();
                    showPaymentModal();
                });
                
                document.getElementById('closeCartBtn').addEventListener('click', () => {
                    modal.remove();
                });
            }
            
            // Close modal when clicking outside
            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    modal.remove();
                }
            });
        }

        function increaseQuantity(index) {
            cart[index].quantity += 1;
            updateCartBadge();
            
            // Close current modal and reopen cart
            const existingModal = document.querySelector('.fixed.inset-0');
            if (existingModal) {
                existingModal.remove();
            }
            showCart();
        }

        function decreaseQuantity(index) {
            if (cart[index].quantity > 1) {
                cart[index].quantity -= 1;
                updateCartBadge();
                
                // Close current modal and reopen cart
                const existingModal = document.querySelector('.fixed.inset-0');
                if (existingModal) {
                    existingModal.remove();
                }
                showCart();
            }
        }

        function showPaymentModal() {
            const total = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4';
            modal.innerHTML = `
                <div class="glass-dark p-6 rounded-2xl max-w-lg w-full max-h-[90vh] overflow-y-auto">
                    <div class="text-center mb-6">
                        <i class="fas fa-wallet text-4xl text-green-400 mb-3"></i>
                        <h2 class="text-2xl font-bold text-white">الدفع بالمحفظة الإلكترونية</h2>
                        <p class="text-gray-300 text-sm mt-2">المبلغ المطلوب: <span class="text-green-400 font-bold text-lg">${total.toFixed(2)} ج.م</span></p>
                    </div>
                    
                    <!-- Wallet Info -->
                    <div class="glass p-4 rounded-lg mb-6">
                        <h3 class="text-white font-bold mb-3 flex items-center gap-2">
                            <i class="fas fa-info-circle text-blue-400"></i>
                            معلومات المحفظة
                        </h3>
                        <div class="space-y-2 text-sm">
                            <div class="flex justify-between">
                                <span class="text-gray-300">رقم المحفظة:</span>
                                <span class="text-white font-mono bg-gray-700 px-2 py-1 rounded" id="walletNumber">${walletNumber}</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-300">اسم المستفيد:</span>
                                <span class="text-white" id="beneficiaryName">${storeName}</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-300">نوع المحفظة:</span>
                                <span class="text-white">${walletProvider === 'vodafone' ? 'فودافون كاش' : walletProvider === 'etisalat' ? 'اتصالات كاش' : 'أورانج كاش'}</span>
                            </div>
                        </div>
                        <button onclick="copyWalletNumber()" class="w-full mt-3 bg-blue-500 hover:bg-blue-600 text-white py-2 rounded-lg transition-all">
                            <i class="fas fa-copy ml-2"></i>
                            نسخ رقم المحفظة
                        </button>
                    </div>
                    
                    <!-- Payment Form -->
                    <div class="space-y-4">
                        <div>
                            <label class="block text-white text-sm font-medium mb-2">
                                <i class="fas fa-mobile-alt ml-2"></i>
                                رقم المحفظة التي تم التحويل منها *
                            </label>
                            <input type="tel" id="senderWallet" placeholder="01xxxxxxxxx" 
                                   class="w-full p-3 rounded-lg bg-white bg-opacity-20 text-white placeholder-gray-300 border border-white border-opacity-30 focus:border-green-400 focus:outline-none transition-all">
                        </div>
                        
                        <div>
                            <label class="block text-white text-sm font-medium mb-2">
                                <i class="fas fa-image ml-2"></i>
                                صورة إيصال التحويل *
                            </label>
                            <div class="relative">
                                <input type="file" id="transferReceipt" accept="image/*" 
                                       class="hidden">
                                <button onclick="document.getElementById('transferReceipt').click()" 
                                        class="w-full p-4 border-2 border-dashed border-white border-opacity-30 rounded-lg text-white hover:border-green-400 transition-all">
                                    <i class="fas fa-cloud-upload-alt text-2xl mb-2"></i>
                                    <p>اضغط لرفع صورة الإيصال</p>
                                    <p class="text-sm text-gray-300 mt-1">PNG, JPG, JPEG (حد أقصى 5MB)</p>
                                </button>
                                <div id="uploadedImagePreview" class="hidden mt-3">
                                    <img id="previewImage" src="" alt="معاينة الصورة" class="w-full max-h-40 object-contain rounded-lg">
                                    <p class="text-green-400 text-sm mt-2 text-center">
                                        <i class="fas fa-check-circle ml-1"></i>
                                        تم رفع الصورة بنجاح
                                    </p>
                                </div>
                            </div>
                        </div>
                        
                        <div>
                            <label class="block text-white text-sm font-medium mb-2">
                                <i class="fas fa-comment ml-2"></i>
                                ملاحظات إضافية (اختياري)
                            </label>
                            <textarea id="paymentNotes" placeholder="أي ملاحظات أو تفاصيل إضافية..." 
                                      class="w-full p-3 rounded-lg bg-white bg-opacity-20 text-white placeholder-gray-300 border border-white border-opacity-30 focus:border-green-400 focus:outline-none transition-all h-20 resize-none"></textarea>
                        </div>
                    </div>
                    
                    <!-- Action Buttons -->
                    <div class="flex gap-3 mt-6">
                        <button id="confirmPaymentBtn" class="flex-1 bg-gradient-to-r from-green-500 to-green-600 p-4 rounded-lg text-white hover:from-green-600 hover:to-green-700 transition-all font-medium">
                            <i class="fas fa-check ml-2"></i>
                            تأكيد الدفع
                        </button>
                        <button id="backToCartBtn" class="bg-gradient-to-r from-gray-500 to-gray-600 p-4 rounded-lg text-white hover:from-gray-600 hover:to-gray-700 transition-all font-medium">
                            <i class="fas fa-arrow-right"></i>
                        </button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            // Handle file upload
            document.getElementById('transferReceipt').addEventListener('change', function(e) {
                const file = e.target.files[0];
                if (file) {
                    if (file.size > 5 * 1024 * 1024) {
                        showNotification('حجم الصورة كبير جداً! الحد الأقصى 5MB ⚠️', 'error');
                        return;
                    }
                    
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        document.getElementById('previewImage').src = e.target.result;
                        document.getElementById('uploadedImagePreview').classList.remove('hidden');
                    };
                    reader.readAsDataURL(file);
                }
            });
            
            // Event listeners
            document.getElementById('confirmPaymentBtn').addEventListener('click', () => {
                const senderWallet = document.getElementById('senderWallet').value.trim();
                const receiptFile = document.getElementById('transferReceipt').files[0];
                
                if (!senderWallet) {
                    showNotification('يرجى إدخال رقم المحفظة! ⚠️', 'error');
                    return;
                }
                
                if (!receiptFile) {
                    showNotification('يرجى رفع صورة الإيصال! ⚠️', 'error');
                    return;
                }
                
                // Simulate payment processing
                showNotification('جاري معالجة الدفع... ⏳', 'info');
                
                setTimeout(() => {
                    showNotification('تم إرسال طلب الدفع بنجاح! سيتم مراجعته خلال 24 ساعة 🎉', 'success');
                    cart = [];
                    updateCartBadge();
                    modal.remove();
                }, 2000);
            });
            
            document.getElementById('backToCartBtn').addEventListener('click', () => {
                modal.remove();
                showCart();
            });
            
            // Close modal when clicking outside
            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    modal.remove();
                }
            });
        }

        function copyWalletNumber() {
            const walletNumber = document.getElementById('walletNumber').textContent;
            navigator.clipboard.writeText(walletNumber).then(() => {
                showNotification('تم نسخ رقم المحفظة! 📋', 'success');
            }).catch(() => {
                showNotification('فشل في نسخ الرقم ❌', 'error');
            });
        }

        function removeFromCart(index) {
            cart.splice(index, 1);
            updateCartBadge();
            showNotification('تم حذف المنتج من السلة! 🗑️', 'info');
            
            // Close current modal and reopen cart
            const existingModal = document.querySelector('.fixed.inset-0');
            if (existingModal) {
                existingModal.remove();
            }
            showCart();
        }

        // Add some interactive effects
        document.addEventListener('DOMContentLoaded', () => {
            // Add focus effects to inputs
            const inputs = document.querySelectorAll('input');
            inputs.forEach(input => {
                input.addEventListener('focus', () => {
                    input.parentElement.style.transform = 'scale(1.02)';
                });
                
                input.addEventListener('blur', () => {
                    input.parentElement.style.transform = 'scale(1)';
                });
            });
            
            // Add click effects to buttons
            const buttons = document.querySelectorAll('button');
            buttons.forEach(button => {
                button.addEventListener('mousedown', () => {
                    button.style.transform = 'scale(0.98)';
                });
                
                button.addEventListener('mouseup', () => {
                    button.style.transform = 'scale(1)';
                });
                
                button.addEventListener('mouseleave', () => {
                    button.style.transform = 'scale(1)';
                });
            });
        });
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9799c5e037117948',t:'MTc1Njk0OTk2NS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
